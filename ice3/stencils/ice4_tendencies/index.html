<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Ice4 tendencies - dwarf-ice3-gt4py</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Ice4 tendencies";
        var mkdocs_page_input_path = "ice3/stencils/ice4_tendencies.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> dwarf-ice3-gt4py
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../translation_options/">Translation Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../namelists/">Namelists</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">drivers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/cli/">Cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/core/">Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ice3</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >components</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice4_tendencies/">Ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust_modular/">Ice adjust modular</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/rain_ice/">Rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >functions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/backup/">Backup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/compute_ice_fraction/">Compute ice fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/gamma/">Gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/icecloud/">Icecloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/interp_micro/">Interp micro</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/sign/">Sign</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/temperature/">Temperature</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/tiwmx/">Tiwmx</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/upwind_sedimentation/">Upwind sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice4_tendencies/">State ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice_adjust/">State ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_rain_ice/">State rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >phyex_common</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/constants/">Constants</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/ice_parameters/">Ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/incomplete_gamma/">Incomplete gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/lookup_table/">Lookup table</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/namparar/">Namparar</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/nebn/">Nebn</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex/">Phyex</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex_dimensions/">Phyex dimensions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_descriptors/">Rain ice descriptors</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_field_address/">Rain ice field address</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_parameters/">Rain ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_raccs/">Xker raccs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_rdryg/">Xker rdryg</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_sdryg/">Xker sdryg</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >stencils</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../ice4_compute_pdf/">Ice4 compute pdf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_correct_negativities/">Ice4 correct negativities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_fast_rg/">Ice4 fast rg</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_fast_ri/">Ice4 fast ri</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_fast_rs/">Ice4 fast rs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_nucleation/">Ice4 nucleation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_rimltc/">Ice4 rimltc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_rrhong/">Ice4 rrhong</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_slow/">Ice4 slow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_stepping/">Ice4 stepping</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Ice4 tendencies</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_warm/">Ice4 warm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="" href="../rain_ice_nucleation.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cloud_fraction/">Cloud fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../condensation/">Condensation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precipitation_fraction_liquid_content/">Precipitation fraction liquid content</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rain_ice/">Rain ice</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sedimentation/">Sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/allocate_random_fields/">Allocate random fields</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/allocate_state/">Allocate state</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/array_dict_operations/">Array dict operations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/compile_fortran/">Compile fortran</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/doctor_norm/">Doctor norm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/env/">Env</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/storage/">Storage</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >testprogs_data</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/main/">Main</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/utils/">Utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >agent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/ICE4_TENDENCIES_STATUS/">ICE4 Tendencies JAX Translation Status</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../agent/RAIN_ICE_TRANSITION_PLAN.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_ice_adjust_modular/">Composant ICE_ADJUST Modulaire</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/TRANSLATION_SUMMARY/">JAX Translation Summary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_cloud_fraction/">Test de reproductibilité - cloud_fraction.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_condensation/">Test de reproductibilité - condensation.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rg_FIXES/">Fixes Applied to test_ice4_fast_rg.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rs_FIXES/">Fixes Applied to test_ice4_fast_rs.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_sigrc_computation_FIXES/">Fixes Applied to test_sigrc_computation.py</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">dwarf-ice3-gt4py</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">ice3</li>
          <li class="breadcrumb-item">stencils</li>
      <li class="breadcrumb-item active">Ice4 tendencies</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="ice3.stencils.ice4_tendencies"></a>
    <div class="doc doc-contents first">

        <p>ICE4 tendency management and aggregation stencils.</p>
<p>This module handles initialization, update, and post-processing of
microphysical tendencies in the ICE4 scheme. It aggregates contributions
from different microphysical processes (nucleation, riming, melting, etc.)
and applies them to prognostic variables with proper thermodynamic
consistency.</p>
<p>Source: PHYEX/src/common/micro/mode_ice4_tendencies.F90</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_derived_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_derived_fields</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rhodref</span><span class="p">,</span> <span class="n">pres</span><span class="p">,</span> <span class="n">ssi</span><span class="p">,</span> <span class="n">ka</span><span class="p">,</span> <span class="n">dv</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">cj</span><span class="p">,</span> <span class="n">rvt</span><span class="p">,</span> <span class="n">zw</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute derived microphysical fields for process calculations.</p>
<p>Calculates auxiliary fields needed by various microphysical parameterizations:
- Supersaturation with respect to ice
- Thermal conductivity of air
- Diffusivity of water vapor
- Thermodynamic function for deposition
- Ventilation coefficient</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_derived_fields--parameters">Parameters</h4>
<p>t : Field[float]
    Temperature (K).
rhodref : Field[float]
    Reference air density (kg/m³).
pres : Field[float]
    Pressure (Pa).
ssi : Field[float]
    Output: Supersaturation w.r.t. ice (dimensionless).
ka : Field[float]
    Output: Thermal conductivity of air (W/(m·K)).
dv : Field[float]
    Output: Diffusivity of water vapor in air (m²/s).
ai : Field[float]
    Output: Thermodynamic function for vapor diffusion.
cj : Field[float]
    Output: Ventilation coefficient (dimensionless).
rvt : Field[float]
    Water vapor mixing ratio (kg/kg).
zw : Field[float]
    Workspace for saturation vapor pressure (Pa).</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_derived_fields--notes">Notes</h4>
<p>These derived fields are used in:
- Deposition/sublimation rates (ai, ssi, ka, dv)
- Ventilation effects (cj)
- Particle growth calculations</p>
<p>The ventilation coefficient cj accounts for enhanced mass transfer
due to particle motion relative to air.</p>
<p>External Parameters:
- ALPI, BETAI, GAMI: Saturation vapor pressure over ice coefficients
- SCFAC: Schmidt number factor for ventilation
- P00: Reference pressure (Pa)</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 220-238</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_derived_fields</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rhodref</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">pres</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ssi</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ka</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">dv</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ai</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">cj</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">zw</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute derived microphysical fields for process calculations.</span>

<span class="sd">    Calculates auxiliary fields needed by various microphysical parameterizations:</span>
<span class="sd">    - Supersaturation with respect to ice</span>
<span class="sd">    - Thermal conductivity of air</span>
<span class="sd">    - Diffusivity of water vapor</span>
<span class="sd">    - Thermodynamic function for deposition</span>
<span class="sd">    - Ventilation coefficient</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : Field[float]</span>
<span class="sd">        Temperature (K).</span>
<span class="sd">    rhodref : Field[float]</span>
<span class="sd">        Reference air density (kg/m³).</span>
<span class="sd">    pres : Field[float]</span>
<span class="sd">        Pressure (Pa).</span>
<span class="sd">    ssi : Field[float]</span>
<span class="sd">        Output: Supersaturation w.r.t. ice (dimensionless).</span>
<span class="sd">    ka : Field[float]</span>
<span class="sd">        Output: Thermal conductivity of air (W/(m·K)).</span>
<span class="sd">    dv : Field[float]</span>
<span class="sd">        Output: Diffusivity of water vapor in air (m²/s).</span>
<span class="sd">    ai : Field[float]</span>
<span class="sd">        Output: Thermodynamic function for vapor diffusion.</span>
<span class="sd">    cj : Field[float]</span>
<span class="sd">        Output: Ventilation coefficient (dimensionless).</span>
<span class="sd">    rvt : Field[float]</span>
<span class="sd">        Water vapor mixing ratio (kg/kg).</span>
<span class="sd">    zw : Field[float]</span>
<span class="sd">        Workspace for saturation vapor pressure (Pa).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    These derived fields are used in:</span>
<span class="sd">    - Deposition/sublimation rates (ai, ssi, ka, dv)</span>
<span class="sd">    - Ventilation effects (cj)</span>
<span class="sd">    - Particle growth calculations</span>

<span class="sd">    The ventilation coefficient cj accounts for enhanced mass transfer</span>
<span class="sd">    due to particle motion relative to air.</span>

<span class="sd">    External Parameters:</span>
<span class="sd">    - ALPI, BETAI, GAMI: Saturation vapor pressure over ice coefficients</span>
<span class="sd">    - SCFAC: Schmidt number factor for ventilation</span>
<span class="sd">    - P00: Reference pressure (Pa)</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 220-238</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">__externals__</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">ALPI</span><span class="p">,</span> <span class="n">BETAI</span><span class="p">,</span> <span class="n">CI</span><span class="p">,</span> <span class="n">CPV</span><span class="p">,</span> <span class="n">EPSILO</span><span class="p">,</span> <span class="n">GAMI</span><span class="p">,</span> <span class="n">LSTT</span><span class="p">,</span> <span class="n">P00</span><span class="p">,</span>
                               <span class="n">RV</span><span class="p">,</span> <span class="n">SCFAC</span><span class="p">,</span> <span class="n">TT</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">zw</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">ALPI</span> <span class="o">-</span> <span class="n">BETAI</span> <span class="o">/</span> <span class="n">t</span> <span class="o">-</span> <span class="n">GAMI</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">ssi</span> <span class="o">=</span> <span class="n">rvt</span> <span class="o">*</span> <span class="p">(</span><span class="n">pres</span> <span class="o">-</span> <span class="n">zw</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">EPSILO</span> <span class="o">*</span> <span class="n">zw</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>  <span class="c1"># Supersaturation over ice</span>
        <span class="n">ka</span> <span class="o">=</span> <span class="mf">2.38e-2</span> <span class="o">+</span> <span class="mf">7.1e-5</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">TT</span><span class="p">)</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="mf">2.11e-5</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">TT</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.94</span> <span class="o">*</span> <span class="p">(</span><span class="n">P00</span> <span class="o">/</span> <span class="n">pres</span><span class="p">)</span>
        <span class="n">ai</span> <span class="o">=</span> <span class="p">(</span><span class="n">LSTT</span> <span class="o">+</span> <span class="p">(</span><span class="n">CPV</span> <span class="o">-</span> <span class="n">CI</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">TT</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">ka</span> <span class="o">*</span> <span class="n">RV</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">RV</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dv</span> <span class="o">*</span> <span class="n">zw</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">cj</span> <span class="o">=</span> <span class="n">SCFAC</span> <span class="o">*</span> <span class="n">rhodref</span><span class="o">**</span><span class="mf">0.3</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1.718e-5</span> <span class="o">+</span> <span class="mf">4.9e-8</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">TT</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_fast_rg_pre_post_processing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_fast_rg_pre_post_processing</span><span class="p">(</span><span class="n">rgsi</span><span class="p">,</span> <span class="n">rgsi_mr</span><span class="p">,</span> <span class="n">rvdepg</span><span class="p">,</span> <span class="n">rsmltg</span><span class="p">,</span> <span class="n">rraccsg</span><span class="p">,</span> <span class="n">rsaccrg</span><span class="p">,</span> <span class="n">rcrimsg</span><span class="p">,</span> <span class="n">rsrimcg</span><span class="p">,</span> <span class="n">rrhong_mr</span><span class="p">,</span> <span class="n">rsrimcg_mr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Aggregate graupel source terms from various processes.</p>
<p>Sums all contributions to graupel production for the fast processes,
separating direct sources from mixing ratio conversions.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_fast_rg_pre_post_processing--parameters">Parameters</h4>
<p>rgsi : Field[float]
    Output: Total graupel source from collection/deposition/melting.
rgsi_mr : Field[float]
    Output: Total graupel source from phase conversions.
rvdepg : Field[float]
    Vapor deposition on graupel.
rsmltg : Field[float]
    Snow melting producing graupel.
rraccsg, rsaccrg : Field[float]
    Accretion processes.
rcrimsg, rsrimcg : Field[float]
    Riming processes.
rrhong_mr, rsrimcg_mr : Field[float]
    Conversion processes.</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 386-390</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_fast_rg_pre_post_processing</span><span class="p">(</span>
    <span class="n">rgsi</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rgsi_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvdepg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsmltg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rraccsg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsaccrg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcrimsg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsrimcg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrhong_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsrimcg_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate graupel source terms from various processes.</span>

<span class="sd">    Sums all contributions to graupel production for the fast processes,</span>
<span class="sd">    separating direct sources from mixing ratio conversions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rgsi : Field[float]</span>
<span class="sd">        Output: Total graupel source from collection/deposition/melting.</span>
<span class="sd">    rgsi_mr : Field[float]</span>
<span class="sd">        Output: Total graupel source from phase conversions.</span>
<span class="sd">    rvdepg : Field[float]</span>
<span class="sd">        Vapor deposition on graupel.</span>
<span class="sd">    rsmltg : Field[float]</span>
<span class="sd">        Snow melting producing graupel.</span>
<span class="sd">    rraccsg, rsaccrg : Field[float]</span>
<span class="sd">        Accretion processes.</span>
<span class="sd">    rcrimsg, rsrimcg : Field[float]</span>
<span class="sd">        Riming processes.</span>
<span class="sd">    rrhong_mr, rsrimcg_mr : Field[float]</span>
<span class="sd">        Conversion processes.</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 386-390</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">rgsi</span> <span class="o">=</span> <span class="n">rvdepg</span> <span class="o">+</span> <span class="n">rsmltg</span> <span class="o">+</span> <span class="n">rraccsg</span> <span class="o">+</span> <span class="n">rsaccrg</span> <span class="o">+</span> <span class="n">rcrimsg</span> <span class="o">+</span> <span class="n">rsrimcg</span>
        <span class="n">rgsi_mr</span> <span class="o">=</span> <span class="n">rrhong_mr</span> <span class="o">+</span> <span class="n">rsrimcg_mr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_increment_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_increment_update</span><span class="p">(</span><span class="n">lsfact</span><span class="p">,</span> <span class="n">lvfact</span><span class="p">,</span> <span class="n">theta_increment</span><span class="p">,</span> <span class="n">rv_increment</span><span class="p">,</span> <span class="n">rc_increment</span><span class="p">,</span> <span class="n">rr_increment</span><span class="p">,</span> <span class="n">ri_increment</span><span class="p">,</span> <span class="n">rs_increment</span><span class="p">,</span> <span class="n">rg_increment</span><span class="p">,</span> <span class="n">rvheni_mr</span><span class="p">,</span> <span class="n">rimltc_mr</span><span class="p">,</span> <span class="n">rrhong_mr</span><span class="p">,</span> <span class="n">rsrimcg_mr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update increment fields with nucleation and phase change processes.</p>
<p>Adds the contributions from heterogeneous nucleation (HENI),
homogeneous freezing (HONG), ice melting (IMLTC), and snow riming
conversion (RSRIMCG) to the increment fields, with proper accounting
for latent heat effects on potential temperature.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_increment_update--parameters">Parameters</h4>
<p>lsfact, lvfact : Field[float]
    Latent heat factors L_s/c_p and L_v/c_p (K).
theta_increment : Field[float]
    Potential temperature increment, updated.
rv_increment, rc_increment, rr_increment : Field[float]
    Vapor, cloud, rain increments, updated.
ri_increment, rs_increment, rg_increment : Field[float]
    Ice, snow, graupel increments, updated.
rvheni_mr : Field[float]
    Vapor consumed by heterogeneous nucleation.
rimltc_mr : Field[float]
    Ice melted to cloud liquid.
rrhong_mr : Field[float]
    Rain frozen homogeneously.
rsrimcg_mr : Field[float]
    Snow converted to graupel by riming.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_increment_update--notes">Notes</h4>
<p>Energy accounting:
- HENI: vapor → ice, releases L_s
- HONG: rain → graupel, releases L_f = L_s - L_v
- IMLTC: ice → cloud, absorbs L_f = L_s - L_v
- RSRIMCG: snow → graupel, no phase change, no heat</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 220-238</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_increment_update</span><span class="p">(</span>
    <span class="n">lsfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lvfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">theta_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rv_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rr_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ri_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rs_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rg_increment</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvheni_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rimltc_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrhong_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsrimcg_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update increment fields with nucleation and phase change processes.</span>

<span class="sd">    Adds the contributions from heterogeneous nucleation (HENI),</span>
<span class="sd">    homogeneous freezing (HONG), ice melting (IMLTC), and snow riming</span>
<span class="sd">    conversion (RSRIMCG) to the increment fields, with proper accounting</span>
<span class="sd">    for latent heat effects on potential temperature.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lsfact, lvfact : Field[float]</span>
<span class="sd">        Latent heat factors L_s/c_p and L_v/c_p (K).</span>
<span class="sd">    theta_increment : Field[float]</span>
<span class="sd">        Potential temperature increment, updated.</span>
<span class="sd">    rv_increment, rc_increment, rr_increment : Field[float]</span>
<span class="sd">        Vapor, cloud, rain increments, updated.</span>
<span class="sd">    ri_increment, rs_increment, rg_increment : Field[float]</span>
<span class="sd">        Ice, snow, graupel increments, updated.</span>
<span class="sd">    rvheni_mr : Field[float]</span>
<span class="sd">        Vapor consumed by heterogeneous nucleation.</span>
<span class="sd">    rimltc_mr : Field[float]</span>
<span class="sd">        Ice melted to cloud liquid.</span>
<span class="sd">    rrhong_mr : Field[float]</span>
<span class="sd">        Rain frozen homogeneously.</span>
<span class="sd">    rsrimcg_mr : Field[float]</span>
<span class="sd">        Snow converted to graupel by riming.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Energy accounting:</span>
<span class="sd">    - HENI: vapor → ice, releases L_s</span>
<span class="sd">    - HONG: rain → graupel, releases L_f = L_s - L_v</span>
<span class="sd">    - IMLTC: ice → cloud, absorbs L_f = L_s - L_v</span>
<span class="sd">    - RSRIMCG: snow → graupel, no phase change, no heat</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 220-238</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 5.1.6 riming-conversion of the large sized aggregates into graupel</span>
    <span class="c1"># Translation note : l189 to l215 omitted (since CSNOWRIMING = M90 in AROME)</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">theta_increment</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">rvheni_mr</span> <span class="o">*</span> <span class="n">lsfact</span>
            <span class="o">+</span> <span class="n">rrhong_mr</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">rimltc_mr</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">rv_increment</span> <span class="o">-=</span> <span class="n">rvheni_mr</span>
        <span class="n">rc_increment</span> <span class="o">+=</span> <span class="n">rimltc_mr</span>
        <span class="n">rr_increment</span> <span class="o">-=</span> <span class="n">rrhong_mr</span>
        <span class="n">ri_increment</span> <span class="o">+=</span> <span class="n">rvheni_mr</span> <span class="o">-</span> <span class="n">rimltc_mr</span>
        <span class="n">rs_increment</span> <span class="o">-=</span> <span class="n">rsrimcg_mr</span>
        <span class="n">rg_increment</span> <span class="o">+=</span> <span class="n">rrhong_mr</span> <span class="o">+</span> <span class="n">rsrimcg_mr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_nucleation_post_processing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_nucleation_post_processing</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exn</span><span class="p">,</span> <span class="n">lsfact</span><span class="p">,</span> <span class="n">tht</span><span class="p">,</span> <span class="n">rvt</span><span class="p">,</span> <span class="n">rit</span><span class="p">,</span> <span class="n">rvheni_mr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply heterogeneous ice nucleation changes to prognostic variables.</p>
<p>Updates potential temperature, temperature, vapor, and ice after
heterogeneous nucleation (HENI process) where water vapor deposits
directly onto ice nuclei to form ice crystals.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_nucleation_post_processing--parameters">Parameters</h4>
<p>t : Field[float]
    Temperature (K), updated with latent heat release.
exn : Field[float]
    Exner function (dimensionless).
lsfact : Field[float]
    Latent heat of sublimation over heat capacity, L_s/c_p (K).
tht : Field[float]
    Potential temperature (K), updated.
rvt : Field[float]
    Water vapor mixing ratio (kg/kg), decreased.
rit : Field[float]
    Ice mixing ratio (kg/kg), increased.
rvheni_mr : Field[float]
    Vapor consumed by heterogeneous nucleation (kg/kg).</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_nucleation_post_processing--notes">Notes</h4>
<p>Process: r_v → r_i (vapor deposits as ice)
Energy: Releases latent heat of sublimation L_s
Temperature change: ΔT = rvheni_mr × L_s/c_p</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 152-157</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_nucleation_post_processing</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">exn</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lsfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">tht</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rit</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvheni_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply heterogeneous ice nucleation changes to prognostic variables.</span>

<span class="sd">    Updates potential temperature, temperature, vapor, and ice after</span>
<span class="sd">    heterogeneous nucleation (HENI process) where water vapor deposits</span>
<span class="sd">    directly onto ice nuclei to form ice crystals.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : Field[float]</span>
<span class="sd">        Temperature (K), updated with latent heat release.</span>
<span class="sd">    exn : Field[float]</span>
<span class="sd">        Exner function (dimensionless).</span>
<span class="sd">    lsfact : Field[float]</span>
<span class="sd">        Latent heat of sublimation over heat capacity, L_s/c_p (K).</span>
<span class="sd">    tht : Field[float]</span>
<span class="sd">        Potential temperature (K), updated.</span>
<span class="sd">    rvt : Field[float]</span>
<span class="sd">        Water vapor mixing ratio (kg/kg), decreased.</span>
<span class="sd">    rit : Field[float]</span>
<span class="sd">        Ice mixing ratio (kg/kg), increased.</span>
<span class="sd">    rvheni_mr : Field[float]</span>
<span class="sd">        Vapor consumed by heterogeneous nucleation (kg/kg).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Process: r_v → r_i (vapor deposits as ice)</span>
<span class="sd">    Energy: Releases latent heat of sublimation L_s</span>
<span class="sd">    Temperature change: ΔT = rvheni_mr × L_s/c_p</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 152-157</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">tht</span> <span class="o">+=</span> <span class="n">rvheni_mr</span> <span class="o">*</span> <span class="n">lsfact</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tht</span> <span class="o">*</span> <span class="n">exn</span>
        <span class="n">rvt</span> <span class="o">-=</span> <span class="n">rvheni_mr</span>
        <span class="n">rit</span> <span class="o">+=</span> <span class="n">rvheni_mr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_rimltc_post_processing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_rimltc_post_processing</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exn</span><span class="p">,</span> <span class="n">lsfact</span><span class="p">,</span> <span class="n">lvfact</span><span class="p">,</span> <span class="n">rimltc_mr</span><span class="p">,</span> <span class="n">tht</span><span class="p">,</span> <span class="n">rct</span><span class="p">,</span> <span class="n">rit</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply ice crystal melting to prognostic variables.</p>
<p>Updates variables after ice crystal melting (IMLTC process) where
small ice crystals melt to form cloud droplets at T &gt; 0°C.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_rimltc_post_processing--parameters">Parameters</h4>
<p>t : Field[float]
    Temperature (K), updated.
exn : Field[float]
    Exner function (dimensionless).
lsfact : Field[float]
    L_s/c_p (K).
lvfact : Field[float]
    L_v/c_p (K).
rimltc_mr : Field[float]
    Ice melted to cloud water (kg/kg).
tht : Field[float]
    Potential temperature (K), updated.
rct : Field[float]
    Cloud liquid mixing ratio (kg/kg), increased.
rit : Field[float]
    Ice crystal mixing ratio (kg/kg), decreased.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_rimltc_post_processing--notes">Notes</h4>
<p>Process: r_i → r_c (ice melts to cloud liquid)
Energy: Absorbs latent heat of fusion L_f = L_s - L_v
Temperature change: ΔT = -rimltc_mr × (L_s - L_v)/c_p (cooling)</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 180-185</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_rimltc_post_processing</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">exn</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lsfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lvfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rimltc_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">tht</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rct</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rit</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply ice crystal melting to prognostic variables.</span>

<span class="sd">    Updates variables after ice crystal melting (IMLTC process) where</span>
<span class="sd">    small ice crystals melt to form cloud droplets at T &gt; 0°C.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : Field[float]</span>
<span class="sd">        Temperature (K), updated.</span>
<span class="sd">    exn : Field[float]</span>
<span class="sd">        Exner function (dimensionless).</span>
<span class="sd">    lsfact : Field[float]</span>
<span class="sd">        L_s/c_p (K).</span>
<span class="sd">    lvfact : Field[float]</span>
<span class="sd">        L_v/c_p (K).</span>
<span class="sd">    rimltc_mr : Field[float]</span>
<span class="sd">        Ice melted to cloud water (kg/kg).</span>
<span class="sd">    tht : Field[float]</span>
<span class="sd">        Potential temperature (K), updated.</span>
<span class="sd">    rct : Field[float]</span>
<span class="sd">        Cloud liquid mixing ratio (kg/kg), increased.</span>
<span class="sd">    rit : Field[float]</span>
<span class="sd">        Ice crystal mixing ratio (kg/kg), decreased.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Process: r_i → r_c (ice melts to cloud liquid)</span>
<span class="sd">    Energy: Absorbs latent heat of fusion L_f = L_s - L_v</span>
<span class="sd">    Temperature change: ΔT = -rimltc_mr × (L_s - L_v)/c_p (cooling)</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 180-185</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">tht</span> <span class="o">-=</span> <span class="n">rimltc_mr</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tht</span> <span class="o">*</span> <span class="n">exn</span>
        <span class="n">rct</span> <span class="o">+=</span> <span class="n">rimltc_mr</span>
        <span class="n">rit</span> <span class="o">-=</span> <span class="n">rimltc_mr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_rrhong_post_processing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_rrhong_post_processing</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exn</span><span class="p">,</span> <span class="n">lsfact</span><span class="p">,</span> <span class="n">lvfact</span><span class="p">,</span> <span class="n">tht</span><span class="p">,</span> <span class="n">rrt</span><span class="p">,</span> <span class="n">rgt</span><span class="p">,</span> <span class="n">rrhong_mr</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply homogeneous freezing of rain to prognostic variables.</p>
<p>Updates variables after homogeneous nucleation (HONG process) where
rain droplets freeze instantly at very cold temperatures (T &lt; -40°C)
to form graupel particles.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_rrhong_post_processing--parameters">Parameters</h4>
<p>t : Field[float]
    Temperature (K), updated.
exn : Field[float]
    Exner function (dimensionless).
lsfact : Field[float]
    L_s/c_p (K).
lvfact : Field[float]
    L_v/c_p (K).
tht : Field[float]
    Potential temperature (K), updated.
rrt : Field[float]
    Rain mixing ratio (kg/kg), decreased.
rgt : Field[float]
    Graupel mixing ratio (kg/kg), increased.
rrhong_mr : Field[float]
    Rain frozen by homogeneous nucleation (kg/kg).</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_rrhong_post_processing--notes">Notes</h4>
<p>Process: r_r → r_g (rain freezes to graupel)
Energy: Releases latent heat of fusion L_f = L_s - L_v
Temperature change: ΔT = rrhong_mr × (L_s - L_v)/c_p</p>
<p>Occurs at T &lt; approximately -40°C where droplets cannot remain liquid.</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 166-171</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_rrhong_post_processing</span><span class="p">(</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">exn</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lsfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lvfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">tht</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rgt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrhong_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply homogeneous freezing of rain to prognostic variables.</span>

<span class="sd">    Updates variables after homogeneous nucleation (HONG process) where</span>
<span class="sd">    rain droplets freeze instantly at very cold temperatures (T &lt; -40°C)</span>
<span class="sd">    to form graupel particles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : Field[float]</span>
<span class="sd">        Temperature (K), updated.</span>
<span class="sd">    exn : Field[float]</span>
<span class="sd">        Exner function (dimensionless).</span>
<span class="sd">    lsfact : Field[float]</span>
<span class="sd">        L_s/c_p (K).</span>
<span class="sd">    lvfact : Field[float]</span>
<span class="sd">        L_v/c_p (K).</span>
<span class="sd">    tht : Field[float]</span>
<span class="sd">        Potential temperature (K), updated.</span>
<span class="sd">    rrt : Field[float]</span>
<span class="sd">        Rain mixing ratio (kg/kg), decreased.</span>
<span class="sd">    rgt : Field[float]</span>
<span class="sd">        Graupel mixing ratio (kg/kg), increased.</span>
<span class="sd">    rrhong_mr : Field[float]</span>
<span class="sd">        Rain frozen by homogeneous nucleation (kg/kg).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Process: r_r → r_g (rain freezes to graupel)</span>
<span class="sd">    Energy: Releases latent heat of fusion L_f = L_s - L_v</span>
<span class="sd">    Temperature change: ΔT = rrhong_mr × (L_s - L_v)/c_p</span>

<span class="sd">    Occurs at T &lt; approximately -40°C where droplets cannot remain liquid.</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 166-171</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">tht</span> <span class="o">+=</span> <span class="n">rrhong_mr</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">tht</span> <span class="o">*</span> <span class="n">exn</span>
        <span class="n">rrt</span> <span class="o">-=</span> <span class="n">rrhong_mr</span>
        <span class="n">rgt</span> <span class="o">+=</span> <span class="n">rrhong_mr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_slope_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_slope_parameters</span><span class="p">(</span><span class="n">rhodref</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">rrt</span><span class="p">,</span> <span class="n">rst</span><span class="p">,</span> <span class="n">rgt</span><span class="p">,</span> <span class="n">lbdar</span><span class="p">,</span> <span class="n">lbdar_rf</span><span class="p">,</span> <span class="n">lbdas</span><span class="p">,</span> <span class="n">lbdag</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute slope parameters (lambda) for hydrometeor size distributions.</p>
<p>Calculates the exponential distribution slope parameters for rain, snow,
and graupel. These lambda values characterize the particle size distribution
N(D) = N₀ exp(-λD) and are fundamental to all microphysical rate calculations.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_slope_parameters--parameters">Parameters</h4>
<p>rhodref : Field[float]
    Reference air density (kg/m³).
t : Field[float]
    Temperature (K).
rrt, rst, rgt : Field[float]
    Rain, snow, graupel mixing ratios (kg/kg).
lbdar : Field[float]
    Output: Rain slope parameter (m⁻¹).
lbdar_rf : Field[float]
    Output: Rain slope for rainfall (m⁻¹), equals lbdar for AROME.
lbdas : Field[float]
    Output: Snow slope parameter (m⁻¹).
lbdag : Field[float]
    Output: Graupel slope parameter (m⁻¹).</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_slope_parameters--notes">Notes</h4>
<p>Standard formula: λ = C × (ρ × r)^β
where C and β are empirical constants (LBR/LBEXR for rain, etc.)</p>
<p>Snow has temperature-dependent option (LSNOW_T):
- At T &gt; 263.15 K: Uses warmer temperature formula
- At T ≤ 263.15 K: Uses colder temperature formula
- Clamped between LBDAS_MIN and LBDAS_MAX</p>
<p>All slopes are set to 0 when the corresponding mixing ratio is 0
to avoid undefined behavior in subsequent calculations.</p>
<p>External Parameters:
- LBR, LBS, LBG: Intercept constants
- LBEXR, LBEXS, LBEXG: Exponent constants
- LSNOW_T: Temperature-dependent snow flag
- TRANS_MP_GAMMAS: Transformation factor for snow</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 285-329</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_slope_parameters</span><span class="p">(</span>
    <span class="n">rhodref</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rgt</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lbdar</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lbdar_rf</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lbdas</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lbdag</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute slope parameters (lambda) for hydrometeor size distributions.</span>

<span class="sd">    Calculates the exponential distribution slope parameters for rain, snow,</span>
<span class="sd">    and graupel. These lambda values characterize the particle size distribution</span>
<span class="sd">    N(D) = N₀ exp(-λD) and are fundamental to all microphysical rate calculations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rhodref : Field[float]</span>
<span class="sd">        Reference air density (kg/m³).</span>
<span class="sd">    t : Field[float]</span>
<span class="sd">        Temperature (K).</span>
<span class="sd">    rrt, rst, rgt : Field[float]</span>
<span class="sd">        Rain, snow, graupel mixing ratios (kg/kg).</span>
<span class="sd">    lbdar : Field[float]</span>
<span class="sd">        Output: Rain slope parameter (m⁻¹).</span>
<span class="sd">    lbdar_rf : Field[float]</span>
<span class="sd">        Output: Rain slope for rainfall (m⁻¹), equals lbdar for AROME.</span>
<span class="sd">    lbdas : Field[float]</span>
<span class="sd">        Output: Snow slope parameter (m⁻¹).</span>
<span class="sd">    lbdag : Field[float]</span>
<span class="sd">        Output: Graupel slope parameter (m⁻¹).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Standard formula: λ = C × (ρ × r)^β</span>
<span class="sd">    where C and β are empirical constants (LBR/LBEXR for rain, etc.)</span>

<span class="sd">    Snow has temperature-dependent option (LSNOW_T):</span>
<span class="sd">    - At T &gt; 263.15 K: Uses warmer temperature formula</span>
<span class="sd">    - At T ≤ 263.15 K: Uses colder temperature formula</span>
<span class="sd">    - Clamped between LBDAS_MIN and LBDAS_MAX</span>

<span class="sd">    All slopes are set to 0 when the corresponding mixing ratio is 0</span>
<span class="sd">    to avoid undefined behavior in subsequent calculations.</span>

<span class="sd">    External Parameters:</span>
<span class="sd">    - LBR, LBS, LBG: Intercept constants</span>
<span class="sd">    - LBEXR, LBEXS, LBEXG: Exponent constants</span>
<span class="sd">    - LSNOW_T: Temperature-dependent snow flag</span>
<span class="sd">    - TRANS_MP_GAMMAS: Transformation factor for snow</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 285-329</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">__externals__</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">G_RTMIN</span><span class="p">,</span> <span class="n">LBDAG_MAX</span><span class="p">,</span> <span class="n">LBDAS_MAX</span><span class="p">,</span> <span class="n">LBDAS_MIN</span><span class="p">,</span> <span class="n">LBEXG</span><span class="p">,</span>
                               <span class="n">LBEXR</span><span class="p">,</span> <span class="n">LBEXS</span><span class="p">,</span> <span class="n">LBG</span><span class="p">,</span> <span class="n">LBR</span><span class="p">,</span> <span class="n">LBS</span><span class="p">,</span> <span class="n">LSNOW_T</span><span class="p">,</span> <span class="n">R_RTMIN</span><span class="p">,</span>
                               <span class="n">S_RTMIN</span><span class="p">,</span> <span class="n">TRANS_MP_GAMMAS</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">lbdar</span> <span class="o">=</span> <span class="n">LBR</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhodref</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">rrt</span><span class="p">,</span> <span class="n">R_RTMIN</span><span class="p">))</span> <span class="o">**</span> <span class="n">LBEXR</span> <span class="k">if</span> <span class="n">rrt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="c1"># Translation note : l293 to l298 omitted LLRFR = True (not used in AROME)</span>
        <span class="c1"># Translation note : l299 to l301 kept (used in AROME)</span>
        <span class="n">lbdar_rf</span> <span class="o">=</span> <span class="n">lbdar</span>

        <span class="k">if</span> <span class="n">__INLINED</span><span class="p">(</span><span class="n">LSNOW_T</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rst</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mf">263.15</span><span class="p">:</span>
                <span class="n">lbdas</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">LBDAS_MAX</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mf">14.554</span> <span class="o">-</span> <span class="mf">0.0423</span> <span class="o">*</span> <span class="n">t</span><span class="p">)),</span> <span class="n">LBDAS_MIN</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">TRANS_MP_GAMMAS</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">rst</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mf">263.15</span><span class="p">:</span>
                <span class="n">lbdas</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">LBDAS_MAX</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="mf">6.226</span> <span class="o">-</span> <span class="mf">0.0106</span> <span class="o">*</span> <span class="n">t</span><span class="p">)),</span> <span class="n">LBDAS_MIN</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">TRANS_MP_GAMMAS</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lbdas</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbdas</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">LBDAS_MAX</span><span class="p">,</span> <span class="n">LBS</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhodref</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">rst</span><span class="p">,</span> <span class="n">S_RTMIN</span><span class="p">))</span> <span class="o">**</span> <span class="n">LBEXS</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rst</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>

        <span class="n">lbdag</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">LBG</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhodref</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">rgt</span><span class="p">,</span> <span class="n">G_RTMIN</span><span class="p">))</span> <span class="o">**</span> <span class="n">LBEXG</span>
            <span class="k">if</span> <span class="n">rgt</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
            <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.ice4_total_tendencies_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_total_tendencies_update</span><span class="p">(</span><span class="n">lsfact</span><span class="p">,</span> <span class="n">lvfact</span><span class="p">,</span> <span class="n">th_tnd</span><span class="p">,</span> <span class="n">rv_tnd</span><span class="p">,</span> <span class="n">rc_tnd</span><span class="p">,</span> <span class="n">rr_tnd</span><span class="p">,</span> <span class="n">ri_tnd</span><span class="p">,</span> <span class="n">rs_tnd</span><span class="p">,</span> <span class="n">rg_tnd</span><span class="p">,</span> <span class="n">rchoni</span><span class="p">,</span> <span class="n">rvdeps</span><span class="p">,</span> <span class="n">riaggs</span><span class="p">,</span> <span class="n">riauts</span><span class="p">,</span> <span class="n">rvdepg</span><span class="p">,</span> <span class="n">rcautr</span><span class="p">,</span> <span class="n">rcaccr</span><span class="p">,</span> <span class="n">rrevav</span><span class="p">,</span> <span class="n">rcberi</span><span class="p">,</span> <span class="n">rsmltg</span><span class="p">,</span> <span class="n">rcmltsr</span><span class="p">,</span> <span class="n">rraccss</span><span class="p">,</span> <span class="n">rraccsg</span><span class="p">,</span> <span class="n">rsaccrg</span><span class="p">,</span> <span class="n">rcrimss</span><span class="p">,</span> <span class="n">rcrimsg</span><span class="p">,</span> <span class="n">rsrimcg</span><span class="p">,</span> <span class="n">ricfrrg</span><span class="p">,</span> <span class="n">rrcfrig</span><span class="p">,</span> <span class="n">ricfrr</span><span class="p">,</span> <span class="n">rcwetg</span><span class="p">,</span> <span class="n">riwetg</span><span class="p">,</span> <span class="n">rrwetg</span><span class="p">,</span> <span class="n">rswetg</span><span class="p">,</span> <span class="n">rcdryg</span><span class="p">,</span> <span class="n">ridryg</span><span class="p">,</span> <span class="n">rrdryg</span><span class="p">,</span> <span class="n">rsdryg</span><span class="p">,</span> <span class="n">rgmltr</span><span class="p">,</span> <span class="n">rwetgh</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Aggregate all microphysical process contributions to total tendencies.</p>
<p>This is the master aggregation function that sums all individual
microphysical process rates to compute the total tendencies for
potential temperature and all hydrometeor species. Ensures mass
and energy conservation across all processes.</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_total_tendencies_update--parameters">Parameters</h4>
<p>lsfact, lvfact : Field[float]
    Latent heat factors (K).
th_tnd, rv_tnd, rc_tnd, rr_tnd, ri_tnd, rs_tnd, rg_tnd : Field[float]
    Total tendency fields to be updated (various units/s).</p>
<p>Process rates (all in kg/kg/s unless noted):
rchoni : Cloud droplet homogeneous freezing
rvdeps : Vapor deposition on snow
riaggs : Ice aggregation to snow
riauts : Ice autoconversion to snow
rvdepg : Vapor deposition on graupel
rcautr : Cloud autoconversion to rain
rcaccr : Cloud accretion by rain
rrevav : Rain evaporation
rcberi : Bergeron-Findeisen effect
rsmltg : Snow melting to graupel
rcmltsr : Cloud collection by melting snow
rraccss, rraccsg : Rain accretion processes
rsaccrg : Snow accretion by graupel
rcrimss, rcrimsg : Cloud riming processes
rsrimcg : Snow riming conversion
ricfrrg, rrcfrig, ricfrr : Contact freezing processes
rcwetg, riwetg, rrwetg, rswetg : Wet growth collection
rcdryg, ridryg, rrdryg, rsdryg : Dry growth collection
rgmltr : Graupel melting
rwetgh : Wet growth to hail (not used in 6-category scheme)</p>
<h4 id="ice3.stencils.ice4_tendencies.ice4_total_tendencies_update--notes">Notes</h4>
<p>The potential temperature tendency accounts for latent heat from:
- Phase changes (L_v for liquid, L_s for ice)
- Difference L_f = L_s - L_v for freezing/melting</p>
<p>Each mixing ratio tendency is the algebraic sum of all processes
that produce (+) or consume (-) that species.</p>
<p>Mass conservation: Total water is conserved
Energy conservation: Latent heat properly accounted</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 454-559</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_total_tendencies_update</span><span class="p">(</span>
    <span class="n">lsfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">lvfact</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">th_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rv_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rr_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ri_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rs_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rg_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rchoni</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvdeps</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">riaggs</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">riauts</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rvdepg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcautr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcaccr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrevav</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcberi</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsmltg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcmltsr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rraccss</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rraccsg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsaccrg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcrimss</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcrimsg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsrimcg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ricfrrg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrcfrig</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ricfrr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcwetg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">riwetg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrwetg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rswetg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rcdryg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ridryg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrdryg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsdryg</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rgmltr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rwetgh</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate all microphysical process contributions to total tendencies.</span>

<span class="sd">    This is the master aggregation function that sums all individual</span>
<span class="sd">    microphysical process rates to compute the total tendencies for</span>
<span class="sd">    potential temperature and all hydrometeor species. Ensures mass</span>
<span class="sd">    and energy conservation across all processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lsfact, lvfact : Field[float]</span>
<span class="sd">        Latent heat factors (K).</span>
<span class="sd">    th_tnd, rv_tnd, rc_tnd, rr_tnd, ri_tnd, rs_tnd, rg_tnd : Field[float]</span>
<span class="sd">        Total tendency fields to be updated (various units/s).</span>

<span class="sd">    Process rates (all in kg/kg/s unless noted):</span>
<span class="sd">    rchoni : Cloud droplet homogeneous freezing</span>
<span class="sd">    rvdeps : Vapor deposition on snow</span>
<span class="sd">    riaggs : Ice aggregation to snow</span>
<span class="sd">    riauts : Ice autoconversion to snow</span>
<span class="sd">    rvdepg : Vapor deposition on graupel</span>
<span class="sd">    rcautr : Cloud autoconversion to rain</span>
<span class="sd">    rcaccr : Cloud accretion by rain</span>
<span class="sd">    rrevav : Rain evaporation</span>
<span class="sd">    rcberi : Bergeron-Findeisen effect</span>
<span class="sd">    rsmltg : Snow melting to graupel</span>
<span class="sd">    rcmltsr : Cloud collection by melting snow</span>
<span class="sd">    rraccss, rraccsg : Rain accretion processes</span>
<span class="sd">    rsaccrg : Snow accretion by graupel</span>
<span class="sd">    rcrimss, rcrimsg : Cloud riming processes</span>
<span class="sd">    rsrimcg : Snow riming conversion</span>
<span class="sd">    ricfrrg, rrcfrig, ricfrr : Contact freezing processes</span>
<span class="sd">    rcwetg, riwetg, rrwetg, rswetg : Wet growth collection</span>
<span class="sd">    rcdryg, ridryg, rrdryg, rsdryg : Dry growth collection</span>
<span class="sd">    rgmltr : Graupel melting</span>
<span class="sd">    rwetgh : Wet growth to hail (not used in 6-category scheme)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The potential temperature tendency accounts for latent heat from:</span>
<span class="sd">    - Phase changes (L_v for liquid, L_s for ice)</span>
<span class="sd">    - Difference L_f = L_s - L_v for freezing/melting</span>

<span class="sd">    Each mixing ratio tendency is the algebraic sum of all processes</span>
<span class="sd">    that produce (+) or consume (-) that species.</span>

<span class="sd">    Mass conservation: Total water is conserved</span>
<span class="sd">    Energy conservation: Latent heat properly accounted</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 454-559</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">th_tnd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">rvdepg</span> <span class="o">*</span> <span class="n">lsfact</span>
            <span class="o">+</span> <span class="n">rchoni</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">rvdeps</span> <span class="o">*</span> <span class="n">lsfact</span>
            <span class="o">-</span> <span class="n">rrevav</span> <span class="o">*</span> <span class="n">lvfact</span>
            <span class="o">+</span> <span class="n">rcrimss</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">rcrimsg</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">rraccss</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">rraccsg</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">rrcfrig</span> <span class="o">-</span> <span class="n">ricfrr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">rcwetg</span> <span class="o">+</span> <span class="n">rrwetg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">rcdryg</span> <span class="o">+</span> <span class="n">rrdryg</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">rgmltr</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">rcberi</span> <span class="o">*</span> <span class="p">(</span><span class="n">lsfact</span> <span class="o">-</span> <span class="n">lvfact</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># (v) Vapor tendency</span>
        <span class="n">rv_tnd</span> <span class="o">+=</span> <span class="o">-</span><span class="n">rvdepg</span> <span class="o">-</span> <span class="n">rvdeps</span> <span class="o">+</span> <span class="n">rrevav</span>

        <span class="c1"># (c) Cloud tendency</span>
        <span class="n">rc_tnd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">rchoni</span>
            <span class="o">-</span> <span class="n">rcautr</span>
            <span class="o">-</span> <span class="n">rcaccr</span>
            <span class="o">-</span> <span class="n">rcrimss</span>
            <span class="o">-</span> <span class="n">rcrimsg</span>
            <span class="o">-</span> <span class="n">rcmltsr</span>
            <span class="o">-</span> <span class="n">rcwetg</span>
            <span class="o">-</span> <span class="n">rcdryg</span>
            <span class="o">-</span> <span class="n">rcberi</span>
        <span class="p">)</span>

        <span class="c1"># (r) Rain tendency</span>
        <span class="n">rr_tnd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">rcautr</span>
            <span class="o">+</span> <span class="n">rcaccr</span>
            <span class="o">-</span> <span class="n">rrevav</span>
            <span class="o">-</span> <span class="n">rraccss</span>
            <span class="o">-</span> <span class="n">rraccsg</span>
            <span class="o">+</span> <span class="n">rcmltsr</span>
            <span class="o">-</span> <span class="n">rrcfrig</span>
            <span class="o">+</span> <span class="n">ricfrr</span>
            <span class="o">-</span> <span class="n">rrwetg</span>
            <span class="o">-</span> <span class="n">rrdryg</span>
            <span class="o">+</span> <span class="n">rgmltr</span>
        <span class="p">)</span>

        <span class="c1"># (i) Ice tendency</span>
        <span class="n">ri_tnd</span> <span class="o">+=</span> <span class="n">rchoni</span> <span class="o">-</span> <span class="n">riaggs</span> <span class="o">-</span> <span class="n">riauts</span> <span class="o">-</span> <span class="n">ricfrrg</span> <span class="o">-</span> <span class="n">ricfrr</span> <span class="o">-</span> <span class="n">riwetg</span> <span class="o">-</span> <span class="n">ridryg</span> <span class="o">+</span> <span class="n">rcberi</span>

        <span class="c1"># (s) Snow tendency</span>
        <span class="n">rs_tnd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">rvdeps</span>
            <span class="o">+</span> <span class="n">riaggs</span>
            <span class="o">+</span> <span class="n">riauts</span>
            <span class="o">+</span> <span class="n">rcrimss</span>
            <span class="o">-</span> <span class="n">rsrimcg</span>
            <span class="o">+</span> <span class="n">rraccss</span>
            <span class="o">-</span> <span class="n">rsaccrg</span>
            <span class="o">-</span> <span class="n">rsmltg</span>
            <span class="o">-</span> <span class="n">rswetg</span>
            <span class="o">-</span> <span class="n">rsdryg</span>
        <span class="p">)</span>

        <span class="c1"># (g) Graupel tendency</span>
        <span class="n">rg_tnd</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">rvdepg</span>
            <span class="o">+</span> <span class="n">rcrimsg</span>
            <span class="o">+</span> <span class="n">rsrimcg</span>
            <span class="o">+</span> <span class="n">rraccsg</span>
            <span class="o">+</span> <span class="n">rsaccrg</span>
            <span class="o">+</span> <span class="n">rsmltg</span>
            <span class="o">+</span> <span class="n">ricfrrg</span>
            <span class="o">+</span> <span class="n">rrcfrig</span>
            <span class="o">+</span> <span class="n">rcwetg</span>
            <span class="o">+</span> <span class="n">riwetg</span>
            <span class="o">+</span> <span class="n">rswetg</span>
            <span class="o">+</span> <span class="n">rrwetg</span>
            <span class="o">+</span> <span class="n">rcdryg</span>
            <span class="o">+</span> <span class="n">ridryg</span>
            <span class="o">+</span> <span class="n">rsdryg</span>
            <span class="o">+</span> <span class="n">rrdryg</span>
            <span class="o">-</span> <span class="n">rgmltr</span>
            <span class="o">-</span> <span class="n">rwetgh</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.init_tendencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_tendencies</span><span class="p">(</span><span class="n">rv_t</span><span class="p">,</span> <span class="n">rc_t</span><span class="p">,</span> <span class="n">rr_t</span><span class="p">,</span> <span class="n">ri_t</span><span class="p">,</span> <span class="n">rs_t</span><span class="p">,</span> <span class="n">rg_t</span><span class="p">,</span> <span class="n">rv_inst</span><span class="p">,</span> <span class="n">rc_inst</span><span class="p">,</span> <span class="n">rr_inst</span><span class="p">,</span> <span class="n">ri_inst</span><span class="p">,</span> <span class="n">rs_inst</span><span class="p">,</span> <span class="n">rg_inst</span><span class="p">,</span> <span class="n">rv_tnd</span><span class="p">,</span> <span class="n">rc_tnd</span><span class="p">,</span> <span class="n">rr_tnd</span><span class="p">,</span> <span class="n">ri_tnd</span><span class="p">,</span> <span class="n">rs_tnd</span><span class="p">,</span> <span class="n">rg_tnd</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize all tendency and instantaneous change fields to zero.</p>
<p>This function resets all tendency accumulators before the microphysics
calculations begin. Essential for proper tendency tracking through
the various microphysical processes.</p>
<h4 id="ice3.stencils.ice4_tendencies.init_tendencies--parameters">Parameters</h4>
<p>rv_t, rc_t, rr_t, ri_t, rs_t, rg_t : Field[float]
    Tendency storage fields for vapor, cloud, rain, ice, snow, graupel.
rv_inst, rc_inst, rr_inst, ri_inst, rs_inst, rg_inst : Field[float]
    Instantaneous change fields (set to 0).
rv_tnd, rc_tnd, rr_tnd, ri_tnd, rs_tnd, rg_tnd : Field[float]
    Total tendency fields (set to 0).</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 129-134</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_tendencies</span><span class="p">(</span>
    <span class="n">rv_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rr_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ri_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rs_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rg_t</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rv_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rr_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ri_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rs_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rg_inst</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rv_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rr_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ri_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rs_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rg_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">]</span>    
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize all tendency and instantaneous change fields to zero.</span>

<span class="sd">    This function resets all tendency accumulators before the microphysics</span>
<span class="sd">    calculations begin. Essential for proper tendency tracking through</span>
<span class="sd">    the various microphysical processes.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rv_t, rc_t, rr_t, ri_t, rs_t, rg_t : Field[float]</span>
<span class="sd">        Tendency storage fields for vapor, cloud, rain, ice, snow, graupel.</span>
<span class="sd">    rv_inst, rc_inst, rr_inst, ri_inst, rs_inst, rg_inst : Field[float]</span>
<span class="sd">        Instantaneous change fields (set to 0).</span>
<span class="sd">    rv_tnd, rc_tnd, rr_tnd, ri_tnd, rs_tnd, rg_tnd : Field[float]</span>
<span class="sd">        Total tendency fields (set to 0).</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 129-134</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="n">rv_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rc_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rr_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ri_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rs_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rg_t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rv_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rc_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rr_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ri_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rs_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rg_inst</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rv_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rc_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rr_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ri_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rs_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">rg_tnd</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_tendencies.mixing_ratio_init" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mixing_ratio_init</span><span class="p">(</span><span class="n">rvheni_mr</span><span class="p">,</span> <span class="n">rrhong_mr</span><span class="p">,</span> <span class="n">rimltc_mr</span><span class="p">,</span> <span class="n">rsrimcg_mr</span><span class="p">,</span> <span class="n">ldsoft</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize mixing ratio increments for specific processes.</p>
<p>Resets the mixing ratio changes from heterogeneous nucleation (HENI),
homogeneous freezing (HONG), ice crystal melting (IMLTC), and
snow riming conversion (RSRIMCG) when in soft mode.</p>
<h4 id="ice3.stencils.ice4_tendencies.mixing_ratio_init--parameters">Parameters</h4>
<p>rvheni_mr : Field[float]
    Vapor consumed by heterogeneous nucleation (kg/kg).
rrhong_mr : Field[float]
    Rain frozen by homogeneous nucleation (kg/kg).
rimltc_mr : Field[float]
    Ice melted to cloud liquid (kg/kg).
rsrimcg_mr : Field[float]
    Snow converted to graupel by riming (kg/kg).
ldsoft : bool
    If True, reset these fields.</p>
<p>Source Reference:
PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 136-140</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_tendencies.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mixing_ratio_init</span><span class="p">(</span>
    <span class="n">rvheni_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rrhong_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rimltc_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rsrimcg_mr</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ldsoft</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize mixing ratio increments for specific processes.</span>

<span class="sd">    Resets the mixing ratio changes from heterogeneous nucleation (HENI),</span>
<span class="sd">    homogeneous freezing (HONG), ice crystal melting (IMLTC), and</span>
<span class="sd">    snow riming conversion (RSRIMCG) when in soft mode.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rvheni_mr : Field[float]</span>
<span class="sd">        Vapor consumed by heterogeneous nucleation (kg/kg).</span>
<span class="sd">    rrhong_mr : Field[float]</span>
<span class="sd">        Rain frozen by homogeneous nucleation (kg/kg).</span>
<span class="sd">    rimltc_mr : Field[float]</span>
<span class="sd">        Ice melted to cloud liquid (kg/kg).</span>
<span class="sd">    rsrimcg_mr : Field[float]</span>
<span class="sd">        Snow converted to graupel by riming (kg/kg).</span>
<span class="sd">    ldsoft : bool</span>
<span class="sd">        If True, reset these fields.</span>

<span class="sd">    Source Reference:</span>
<span class="sd">    PHYEX/src/common/micro/mode_ice4_tendencies.F90, lines 136-140</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ldsoft</span><span class="p">:</span>
            <span class="n">rvheni_mr</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">rrhong_mr</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">rimltc_mr</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">rsrimcg_mr</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ice4_stepping/" class="btn btn-neutral float-left" title="Ice4 stepping"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ice4_warm/" class="btn btn-neutral float-right" title="Ice4 warm">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ice4_stepping/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ice4_warm/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
