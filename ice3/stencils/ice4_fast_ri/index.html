<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Ice4 fast ri - dwarf-ice3-gt4py</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Ice4 fast ri";
        var mkdocs_page_input_path = "ice3/stencils/ice4_fast_ri.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> dwarf-ice3-gt4py
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../translation_options/">Translation Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../namelists/">Namelists</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">drivers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/cli/">Cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/core/">Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ice3</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >components</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice4_tendencies/">Ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust_modular/">Ice adjust modular</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/rain_ice/">Rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >functions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/backup/">Backup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/compute_ice_fraction/">Compute ice fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/gamma/">Gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/icecloud/">Icecloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/interp_micro/">Interp micro</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/sign/">Sign</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/temperature/">Temperature</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/tiwmx/">Tiwmx</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/upwind_sedimentation/">Upwind sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice4_tendencies/">State ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice_adjust/">State ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_rain_ice/">State rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >phyex_common</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/constants/">Constants</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/ice_parameters/">Ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/incomplete_gamma/">Incomplete gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/lookup_table/">Lookup table</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/namparar/">Namparar</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/nebn/">Nebn</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex/">Phyex</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex_dimensions/">Phyex dimensions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_descriptors/">Rain ice descriptors</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_field_address/">Rain ice field address</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_parameters/">Rain ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_raccs/">Xker raccs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_rdryg/">Xker rdryg</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_sdryg/">Xker sdryg</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >stencils</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../ice4_compute_pdf/">Ice4 compute pdf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_correct_negativities/">Ice4 correct negativities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_fast_rg/">Ice4 fast rg</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Ice4 fast ri</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_fast_rs/">Ice4 fast rs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_nucleation/">Ice4 nucleation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_rimltc/">Ice4 rimltc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_rrhong/">Ice4 rrhong</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_slow/">Ice4 slow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_stepping/">Ice4 stepping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_tendencies/">Ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice4_warm/">Ice4 warm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="" href="../rain_ice_nucleation.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cloud_fraction/">Cloud fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../condensation/">Condensation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../precipitation_fraction_liquid_content/">Precipitation fraction liquid content</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../rain_ice/">Rain ice</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sedimentation/">Sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/allocate_random_fields/">Allocate random fields</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/allocate_state/">Allocate state</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/array_dict_operations/">Array dict operations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/compile_fortran/">Compile fortran</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/doctor_norm/">Doctor norm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/env/">Env</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/storage/">Storage</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >testprogs_data</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/main/">Main</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/utils/">Utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >agent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/ICE4_TENDENCIES_STATUS/">ICE4 Tendencies JAX Translation Status</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../agent/RAIN_ICE_TRANSITION_PLAN.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_ice_adjust_modular/">Composant ICE_ADJUST Modulaire</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/TRANSLATION_SUMMARY/">JAX Translation Summary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_cloud_fraction/">Test de reproductibilité - cloud_fraction.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_condensation/">Test de reproductibilité - condensation.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rg_FIXES/">Fixes Applied to test_ice4_fast_rg.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rs_FIXES/">Fixes Applied to test_ice4_fast_rs.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_sigrc_computation_FIXES/">Fixes Applied to test_sigrc_computation.py</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">dwarf-ice3-gt4py</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">ice3</li>
          <li class="breadcrumb-item">stencils</li>
      <li class="breadcrumb-item active">Ice4 fast ri</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="ice3.stencils.ice4_fast_ri"></a>
    <div class="doc doc-contents first">

        <p>Fast ice crystal processes - Bergeron-Findeisen effect for ICE4 scheme.</p>
<p>This module implements the Bergeron-Findeisen effect, where cloud droplets
evaporate to provide water vapor that deposits onto ice crystals. This
preferential growth of ice at the expense of liquid water occurs in
mixed-phase clouds due to the lower saturation vapor pressure over ice
compared to liquid water at the same temperature.</p>
<p>Source: PHYEX/src/common/micro/mode_ice4_fast_ri.F90</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="ice3.stencils.ice4_fast_ri.ice4_fast_ri" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ice4_fast_ri</span><span class="p">(</span><span class="n">ldcompute</span><span class="p">,</span> <span class="n">rhodref</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">cj</span><span class="p">,</span> <span class="n">cit</span><span class="p">,</span> <span class="n">ssi</span><span class="p">,</span> <span class="n">rct</span><span class="p">,</span> <span class="n">rit</span><span class="p">,</span> <span class="n">rc_beri_tnd</span><span class="p">,</span> <span class="n">ldsoft</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the Bergeron-Findeisen effect (RCBERI tendency).</p>
<p>This function calculates the rate at which cloud droplets evaporate
to deposit as ice on existing ice crystals in supersaturated conditions
with respect to ice. This process is fundamental in mixed-phase clouds
and leads to rapid glaciation.</p>
<h4 id="ice3.stencils.ice4_fast_ri.ice4_fast_ri--parameters">Parameters</h4>
<p>ldcompute : Field[bool]
    Mask indicating which grid points require microphysical computation.
rhodref : Field[float]
    Reference air density (kg/m³).
ai : Field[float]
    Thermodynamical function for vapor diffusion (m²·s·kg⁻¹).
    Related to vapor diffusivity and thermal conductivity.
cj : Field[float]
    Ventilation coefficient function (dimensionless).
    Accounts for enhanced deposition due to particle motion.
cit : Field[float]
    Ice crystal number concentration (m⁻³).
ssi : Field[float]
    Supersaturation with respect to ice (dimensionless).
    ssi = (e/e_sat_i) - 1, where ssi &gt; 0 indicates supersaturation.
rct : Field[float]
    Cloud liquid water mixing ratio at time t (kg/kg).
rit : Field[float]
    Pristine ice crystal mixing ratio at time t (kg/kg).
rc_beri_tnd : Field[float]
    Output: Tendency for cloud water due to Bergeron-Findeisen effect (kg/kg/s).
    Negative values indicate evaporation of cloud droplets.
ldsoft : bool
    If True, use previously computed tendencies without recalculation.
    If False, compute new tendencies.</p>
<h4 id="ice3.stencils.ice4_fast_ri.ice4_fast_ri--notes">Notes</h4>
<p>Physical Process:
The Bergeron-Findeisen effect occurs when:
- Air is supersaturated with respect to ice (ssi &gt; 0)
- Air is subsaturated with respect to liquid water
- Both liquid droplets and ice crystals coexist</p>
<p>In this condition:
- Cloud droplets evaporate (providing water vapor)
- Water vapor deposits onto ice crystals
- Net result: conversion of liquid to ice</p>
<p>The deposition rate depends on:
- Ice crystal size (via lambda_i, computed from rit and cit)
- Supersaturation magnitude (ssi)
- Ventilation effects (enhanced by particle motion, via cj)
- Crystal number concentration (cit)</p>
<p>Algorithm:
1. Check if conditions are met (ssi &gt; 0, sufficient rct, rit, cit)
2. Compute ice crystal size parameter lambda_i from mass and number
3. Calculate deposition rate using diffusion theory
4. Include ventilation correction for moving particles</p>
<p>External Parameters:
- C_RTMIN, I_RTMIN: Minimum thresholds for cloud and ice (kg/kg)
- LBI, LBEXI: Parameters for ice crystal size distribution
- O0DEPI, O2DEPI: Deposition coefficients (no ventilation, with ventilation)
- DI: Exponent for ice crystal size distribution</p>
<p>The lambda_i calculation is capped at 1e8 m⁻¹ to avoid numerical issues
with very small ice crystals.</p>
<h4 id="ice3.stencils.ice4_fast_ri.ice4_fast_ri--references">References</h4>
<p>Bergeron, T., 1935: On the physics of clouds and precipitation.
Proces Verbaux de l'Association de Météorologie, UGGI, 156–178.</p>
<p>Findeisen, W., 1938: Die kolloidmeteorologischen Vorgänge bei der
Niederschlagsbildung (Colloidal meteorological processes in the
formation of precipitation). Meteor. Z., 55, 121–133.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/stencils/ice4_fast_ri.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ice4_fast_ri</span><span class="p">(</span>
    <span class="n">ldcompute</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;bool&quot;</span><span class="p">],</span>
    <span class="n">rhodref</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ai</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">cj</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">cit</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ssi</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rct</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rit</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">rc_beri_tnd</span><span class="p">:</span> <span class="n">Field</span><span class="p">[</span><span class="s2">&quot;float&quot;</span><span class="p">],</span>
    <span class="n">ldsoft</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Bergeron-Findeisen effect (RCBERI tendency).</span>

<span class="sd">    This function calculates the rate at which cloud droplets evaporate</span>
<span class="sd">    to deposit as ice on existing ice crystals in supersaturated conditions</span>
<span class="sd">    with respect to ice. This process is fundamental in mixed-phase clouds</span>
<span class="sd">    and leads to rapid glaciation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ldcompute : Field[bool]</span>
<span class="sd">        Mask indicating which grid points require microphysical computation.</span>
<span class="sd">    rhodref : Field[float]</span>
<span class="sd">        Reference air density (kg/m³).</span>
<span class="sd">    ai : Field[float]</span>
<span class="sd">        Thermodynamical function for vapor diffusion (m²·s·kg⁻¹).</span>
<span class="sd">        Related to vapor diffusivity and thermal conductivity.</span>
<span class="sd">    cj : Field[float]</span>
<span class="sd">        Ventilation coefficient function (dimensionless).</span>
<span class="sd">        Accounts for enhanced deposition due to particle motion.</span>
<span class="sd">    cit : Field[float]</span>
<span class="sd">        Ice crystal number concentration (m⁻³).</span>
<span class="sd">    ssi : Field[float]</span>
<span class="sd">        Supersaturation with respect to ice (dimensionless).</span>
<span class="sd">        ssi = (e/e_sat_i) - 1, where ssi &gt; 0 indicates supersaturation.</span>
<span class="sd">    rct : Field[float]</span>
<span class="sd">        Cloud liquid water mixing ratio at time t (kg/kg).</span>
<span class="sd">    rit : Field[float]</span>
<span class="sd">        Pristine ice crystal mixing ratio at time t (kg/kg).</span>
<span class="sd">    rc_beri_tnd : Field[float]</span>
<span class="sd">        Output: Tendency for cloud water due to Bergeron-Findeisen effect (kg/kg/s).</span>
<span class="sd">        Negative values indicate evaporation of cloud droplets.</span>
<span class="sd">    ldsoft : bool</span>
<span class="sd">        If True, use previously computed tendencies without recalculation.</span>
<span class="sd">        If False, compute new tendencies.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Physical Process:</span>
<span class="sd">    The Bergeron-Findeisen effect occurs when:</span>
<span class="sd">    - Air is supersaturated with respect to ice (ssi &gt; 0)</span>
<span class="sd">    - Air is subsaturated with respect to liquid water</span>
<span class="sd">    - Both liquid droplets and ice crystals coexist</span>

<span class="sd">    In this condition:</span>
<span class="sd">    - Cloud droplets evaporate (providing water vapor)</span>
<span class="sd">    - Water vapor deposits onto ice crystals</span>
<span class="sd">    - Net result: conversion of liquid to ice</span>

<span class="sd">    The deposition rate depends on:</span>
<span class="sd">    - Ice crystal size (via lambda_i, computed from rit and cit)</span>
<span class="sd">    - Supersaturation magnitude (ssi)</span>
<span class="sd">    - Ventilation effects (enhanced by particle motion, via cj)</span>
<span class="sd">    - Crystal number concentration (cit)</span>

<span class="sd">    Algorithm:</span>
<span class="sd">    1. Check if conditions are met (ssi &gt; 0, sufficient rct, rit, cit)</span>
<span class="sd">    2. Compute ice crystal size parameter lambda_i from mass and number</span>
<span class="sd">    3. Calculate deposition rate using diffusion theory</span>
<span class="sd">    4. Include ventilation correction for moving particles</span>

<span class="sd">    External Parameters:</span>
<span class="sd">    - C_RTMIN, I_RTMIN: Minimum thresholds for cloud and ice (kg/kg)</span>
<span class="sd">    - LBI, LBEXI: Parameters for ice crystal size distribution</span>
<span class="sd">    - O0DEPI, O2DEPI: Deposition coefficients (no ventilation, with ventilation)</span>
<span class="sd">    - DI: Exponent for ice crystal size distribution</span>

<span class="sd">    The lambda_i calculation is capped at 1e8 m⁻¹ to avoid numerical issues</span>
<span class="sd">    with very small ice crystals.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Bergeron, T., 1935: On the physics of clouds and precipitation.</span>
<span class="sd">    Proces Verbaux de l&#39;Association de Météorologie, UGGI, 156–178.</span>

<span class="sd">    Findeisen, W., 1938: Die kolloidmeteorologischen Vorgänge bei der</span>
<span class="sd">    Niederschlagsbildung (Colloidal meteorological processes in the</span>
<span class="sd">    formation of precipitation). Meteor. Z., 55, 121–133.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">__externals__</span><span class="w"> </span><span class="kn">import</span> <span class="n">C_RTMIN</span><span class="p">,</span> <span class="n">DI</span><span class="p">,</span> <span class="n">I_RTMIN</span><span class="p">,</span> <span class="n">LBEXI</span><span class="p">,</span> <span class="n">LBI</span><span class="p">,</span> <span class="n">O0DEPI</span><span class="p">,</span> <span class="n">O2DEPI</span>

    <span class="c1"># 7.2 Bergeron-Findeisen effect: RCBERI</span>
    <span class="k">with</span> <span class="n">computation</span><span class="p">(</span><span class="n">PARALLEL</span><span class="p">),</span> <span class="n">interval</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">ssi</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">rct</span> <span class="o">&gt;</span> <span class="n">C_RTMIN</span>
            <span class="ow">and</span> <span class="n">rit</span> <span class="o">&gt;</span> <span class="n">I_RTMIN</span>
            <span class="ow">and</span> <span class="n">cit</span> <span class="o">&gt;</span> <span class="mf">1e-20</span>
            <span class="ow">and</span> <span class="n">ldcompute</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ldsoft</span><span class="p">:</span>
                <span class="c1"># Compute ice crystal slope parameter lambda_i</span>
                <span class="n">rc_beri_tnd</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="mf">1e8</span><span class="p">,</span> <span class="n">LBI</span> <span class="o">*</span> <span class="p">(</span><span class="n">rhodref</span> <span class="o">*</span> <span class="n">rit</span> <span class="o">/</span> <span class="n">cit</span><span class="p">)</span> <span class="o">**</span> <span class="n">LBEXI</span>
                <span class="p">)</span>  <span class="c1"># lambda_i</span>

                <span class="c1"># Compute deposition rate with ventilation correction</span>
                <span class="n">rc_beri_tnd</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">ssi</span> <span class="o">/</span> <span class="p">(</span><span class="n">rhodref</span> <span class="o">*</span> <span class="n">ai</span><span class="p">))</span>
                    <span class="o">*</span> <span class="n">cit</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">O0DEPI</span> <span class="o">/</span> <span class="n">rc_beri_tnd</span> <span class="o">+</span> <span class="n">O2DEPI</span> <span class="o">*</span> <span class="n">cj</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">rc_beri_tnd</span> <span class="o">**</span> <span class="p">(</span><span class="n">DI</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">rc_beri_tnd</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ice4_fast_rg/" class="btn btn-neutral float-left" title="Ice4 fast rg"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../ice4_fast_rs/" class="btn btn-neutral float-right" title="Ice4 fast rs">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ice4_fast_rg/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../ice4_fast_rs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
