<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Allocate state - dwarf-ice3-gt4py</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Allocate state";
        var mkdocs_page_input_path = "ice3/utils/allocate_state.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> dwarf-ice3-gt4py
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../translation_options/">Translation Notes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../namelists/">Namelists</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">drivers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/cli/">Cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../drivers/core/">Core</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">ice3</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >components</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice4_tendencies/">Ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/ice_adjust_modular/">Ice adjust modular</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../components/rain_ice/">Rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >functions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/backup/">Backup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/compute_ice_fraction/">Compute ice fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/gamma/">Gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/icecloud/">Icecloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/interp_micro/">Interp micro</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/sign/">Sign</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/temperature/">Temperature</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/tiwmx/">Tiwmx</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../functions/upwind_sedimentation/">Upwind sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice4_tendencies/">State ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_ice_adjust/">State ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../initialisation/state_rain_ice/">State rain ice</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >phyex_common</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/constants/">Constants</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/ice_parameters/">Ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/incomplete_gamma/">Incomplete gamma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/lookup_table/">Lookup table</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/namparar/">Namparar</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/nebn/">Nebn</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex/">Phyex</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/phyex_dimensions/">Phyex dimensions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_descriptors/">Rain ice descriptors</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_field_address/">Rain ice field address</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/rain_ice_parameters/">Rain ice parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_raccs/">Xker raccs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_rdryg/">Xker rdryg</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../phyex_common/xker_sdryg/">Xker sdryg</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >stencils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_compute_pdf/">Ice4 compute pdf</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_correct_negativities/">Ice4 correct negativities</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_fast_rg/">Ice4 fast rg</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_fast_ri/">Ice4 fast ri</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_fast_rs/">Ice4 fast rs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_nucleation/">Ice4 nucleation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_rimltc/">Ice4 rimltc</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_rrhong/">Ice4 rrhong</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_slow/">Ice4 slow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_stepping/">Ice4 stepping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_tendencies/">Ice4 tendencies</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice4_warm/">Ice4 warm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/ice_adjust/">Ice adjust</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../stencils/rain_ice_nucleation.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/cloud_fraction/">Cloud fraction</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/condensation/">Condensation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/precipitation_fraction_liquid_content/">Precipitation fraction liquid content</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/rain_ice/">Rain ice</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../stencils/sedimentation/">Sedimentation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >utils</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../allocate_random_fields/">Allocate random fields</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Allocate state</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../array_dict_operations/">Array dict operations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../compile_fortran/">Compile fortran</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../doctor_norm/">Doctor norm</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../env/">Env</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../storage/">Storage</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >testprogs_data</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/main/">Main</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../testprogs_data/utils/">Utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >agent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/ICE4_TENDENCIES_STATUS/">ICE4 Tendencies JAX Translation Status</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../agent/RAIN_ICE_TRANSITION_PLAN.md">None</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_ice_adjust_modular/">Composant ICE_ADJUST Modulaire</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/TRANSLATION_SUMMARY/">JAX Translation Summary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_cloud_fraction/">Test de reproductibilité - cloud_fraction.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/README_condensation/">Test de reproductibilité - condensation.py vs PHYEX-IAL_CY50T1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rg_FIXES/">Fixes Applied to test_ice4_fast_rg.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_ice4_fast_rs_FIXES/">Fixes Applied to test_ice4_fast_rs.py</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../agent/test_sigrc_computation_FIXES/">Fixes Applied to test_sigrc_computation.py</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">dwarf-ice3-gt4py</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">ice3</li>
          <li class="breadcrumb-item">utils</li>
      <li class="breadcrumb-item active">Allocate state</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="ice3.utils.allocate_state"></a>
    <div class="doc doc-contents first">

        <p>Utilities for initializing GT4Py storage from buffer data.</p>
<p>This module provides functions to initialize GT4Py storage objects from NumPy arrays,
handling the conversion between different dimensional representations. It's particularly
useful for setting up initial conditions from existing data (e.g., NetCDF files).</p>
<p>The functions handle the expansion of dimensions to match GT4Py's expected 3D structure
(ni, nj, nk) even when the input data is 2D (ni, nk) with nj=1.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="ice3.utils.allocate_state.assign" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Assign array data from source to destination.</p>
<p>Provides a unified interface for array assignment that works across both CPU
(NumPy) and GPU (CuPy) arrays. This function performs an in-place copy of data
from the right-hand side (source) to the left-hand side (destination) using
slice assignment, which is compatible with both NumPy and CuPy.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>lhs</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>Left-hand side array (destination storage) - modified in place</p>
              </div>
            </li>
            <li>
              <b><code>rhs</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>Right-hand side array (source data) - not modified</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="note" open>
  <summary>Note</summary>
  <p>The destination array (lhs) must be pre-allocated and have compatible shape
with the source array (rhs). Broadcasting rules apply.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/utils/allocate_state.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign</span><span class="p">(</span><span class="n">lhs</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign array data from source to destination.</span>

<span class="sd">    Provides a unified interface for array assignment that works across both CPU</span>
<span class="sd">    (NumPy) and GPU (CuPy) arrays. This function performs an in-place copy of data</span>
<span class="sd">    from the right-hand side (source) to the left-hand side (destination) using</span>
<span class="sd">    slice assignment, which is compatible with both NumPy and CuPy.</span>

<span class="sd">    Args:</span>
<span class="sd">        lhs (NDArray): Left-hand side array (destination storage) - modified in place</span>
<span class="sd">        rhs (NDArray): Right-hand side array (source data) - not modified</span>

<span class="sd">    Note:</span>
<span class="sd">        The destination array (lhs) must be pre-allocated and have compatible shape</span>
<span class="sd">        with the source array (rhs). Broadcasting rules apply.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lhs</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">rhs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.utils.allocate_state.initialize_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize an xarray DataArray field with data from a buffer.</p>
<p>Automatically detects whether the field is 2D or 3D and calls the appropriate
initialization function. This provides a convenient high-level interface for
setting up field data from external sources (e.g., NetCDF files, initial conditions).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>field</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>xarray DataArray with GT4Py storage in its .data attribute,
must be either 2D or 3D</p>
              </div>
            </li>
            <li>
              <b><code>buffer</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>Source data array to copy into the field, shape should match
the field dimensions</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the field is neither 2D nor 3D</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/utils/allocate_state.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_field</span><span class="p">(</span><span class="n">field</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize an xarray DataArray field with data from a buffer.</span>

<span class="sd">    Automatically detects whether the field is 2D or 3D and calls the appropriate</span>
<span class="sd">    initialization function. This provides a convenient high-level interface for</span>
<span class="sd">    setting up field data from external sources (e.g., NetCDF files, initial conditions).</span>

<span class="sd">    Args:</span>
<span class="sd">        field (xr.DataArray): xarray DataArray with GT4Py storage in its .data attribute,</span>
<span class="sd">            must be either 2D or 3D</span>
<span class="sd">        buffer (NDArray): Source data array to copy into the field, shape should match</span>
<span class="sd">            the field dimensions</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the field is neither 2D nor 3D</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">initialize_storage_2d</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">initialize_storage_3d</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The field to initialize must be either 2-d or 3-d.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.utils.allocate_state.initialize_storage_2d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_storage_2d</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize GT4Py storage from 2D buffer data by adding a singleton j-dimension.</p>
<p>Converts 2D data of shape (ni, nk) into 3D storage of shape (ni, 1, nk) by
inserting a dimension of size 1 for the j-axis (horizontal y-direction). This is
necessary because GT4Py stencils expect 3D fields even for column or 2D slice data.</p>
<p>GPU (CuPy) / CPU (NumPy) compatible.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>storage</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>GT4Py storage object to populate, expected shape (ni, 1, nk)</p>
              </div>
            </li>
            <li>
              <b><code>buffer</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>Source 2D data array, shape (ni, nk)</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/utils/allocate_state.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_storage_2d</span><span class="p">(</span><span class="n">storage</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize GT4Py storage from 2D buffer data by adding a singleton j-dimension.</span>

<span class="sd">    Converts 2D data of shape (ni, nk) into 3D storage of shape (ni, 1, nk) by</span>
<span class="sd">    inserting a dimension of size 1 for the j-axis (horizontal y-direction). This is</span>
<span class="sd">    necessary because GT4Py stencils expect 3D fields even for column or 2D slice data.</span>

<span class="sd">    GPU (CuPy) / CPU (NumPy) compatible.</span>

<span class="sd">    Args:</span>
<span class="sd">        storage (NDArray): GT4Py storage object to populate, expected shape (ni, 1, nk)</span>
<span class="sd">        buffer (NDArray): Source 2D data array, shape (ni, nk)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">assign</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">buffer</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="ice3.utils.allocate_state.initialize_storage_3d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_storage_3d</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize GT4Py storage from 3D buffer data by adding a singleton j-dimension.</p>
<p>Converts 3D data of shape (ni, nk) into 3D storage of shape (ni, 1, nk) by
inserting a dimension of size 1 for the j-axis (horizontal y-direction). This
handles the common case where input data doesn't include the j-dimension but
GT4Py stencils require it.</p>
<p>GPU (CuPy) / CPU (NumPy) compatible.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>storage</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>GT4Py storage object to populate, expected shape (ni, 1, nk)</p>
              </div>
            </li>
            <li>
              <b><code>buffer</code></b>
                  (<code><span title="numpy.typing.NDArray">NDArray</span></code>)
              –
              <div class="doc-md-description">
                <p>Source 3D data array, shape (ni, nk) - despite the name, 
this is typically 2D data that will be expanded to 3D</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/ice3/utils/allocate_state.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_storage_3d</span><span class="p">(</span><span class="n">storage</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize GT4Py storage from 3D buffer data by adding a singleton j-dimension.</span>

<span class="sd">    Converts 3D data of shape (ni, nk) into 3D storage of shape (ni, 1, nk) by</span>
<span class="sd">    inserting a dimension of size 1 for the j-axis (horizontal y-direction). This</span>
<span class="sd">    handles the common case where input data doesn&#39;t include the j-dimension but</span>
<span class="sd">    GT4Py stencils require it.</span>

<span class="sd">    GPU (CuPy) / CPU (NumPy) compatible.</span>

<span class="sd">    Args:</span>
<span class="sd">        storage (NDArray): GT4Py storage object to populate, expected shape (ni, 1, nk)</span>
<span class="sd">        buffer (NDArray): Source 3D data array, shape (ni, nk) - despite the name, </span>
<span class="sd">            this is typically 2D data that will be expanded to 3D</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># expand a dimension of size 1 for nj</span>
    <span class="n">assign</span><span class="p">(</span><span class="n">storage</span><span class="p">,</span> <span class="n">buffer</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../allocate_random_fields/" class="btn btn-neutral float-left" title="Allocate random fields"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../array_dict_operations/" class="btn btn-neutral float-right" title="Array dict operations">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../allocate_random_fields/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../array_dict_operations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
